# mise configuration for suggest-claude-md
[tools]
go = "1.24"

[tasks.build]
description = "Build the binary for current platform"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md ./src
echo "‚úÖ Build complete: build/suggest-claude-md"
"""

[tasks.build-all]
description = "Build for all supported platforms"
depends = ["build-linux-amd64", "build-linux-arm64", "build-darwin-amd64", "build-darwin-arm64", "build-windows-amd64"]

[tasks.build-linux-amd64]
description = "Build for Linux AMD64"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
GOOS=linux GOARCH=amd64 go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md-linux-amd64 ./src
echo "‚úÖ Built: build/suggest-claude-md-linux-amd64"
"""

[tasks.build-linux-arm64]
description = "Build for Linux ARM64"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
GOOS=linux GOARCH=arm64 go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md-linux-arm64 ./src
echo "‚úÖ Built: build/suggest-claude-md-linux-arm64"
"""

[tasks.build-darwin-amd64]
description = "Build for macOS AMD64"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
GOOS=darwin GOARCH=amd64 go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md-darwin-amd64 ./src
echo "‚úÖ Built: build/suggest-claude-md-darwin-amd64"
"""

[tasks.build-darwin-arm64]
description = "Build for macOS ARM64 (Apple Silicon)"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
GOOS=darwin GOARCH=arm64 go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md-darwin-arm64 ./src
echo "‚úÖ Built: build/suggest-claude-md-darwin-arm64"
"""

[tasks.build-windows-amd64]
description = "Build for Windows AMD64"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
GOOS=windows GOARCH=amd64 go build -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md-windows-amd64.exe ./src
echo "‚úÖ Built: build/suggest-claude-md-windows-amd64.exe"
"""

[tasks.dev]
description = "Development build with race detector"
run = """
mkdir -p build
VERSION=$(git describe --tags --always --dirty 2>/dev/null || echo "dev")
go build -race -ldflags "-X main.version=${VERSION}" -o build/suggest-claude-md ./src
echo "‚úÖ Development build complete (with race detector): build/suggest-claude-md"
"""

[tasks.clean]
description = "Remove build artifacts"
run = """
rm -rf build
rm -f suggest-claude-md
echo "üßπ Cleaned build artifacts"
"""

[tasks.install]
description = "Install to /usr/local/bin"
depends = ["build"]
run = """
sudo cp build/suggest-claude-md /usr/local/bin/
sudo chmod +x /usr/local/bin/suggest-claude-md
echo "‚úÖ Installed to /usr/local/bin/suggest-claude-md"
"""

[tasks.uninstall]
description = "Remove from /usr/local/bin"
run = """
sudo rm -f /usr/local/bin/suggest-claude-md
echo "‚úÖ Uninstalled from /usr/local/bin/suggest-claude-md"
"""

[tasks.test]
description = "Run tests"
run = "go test -v ./src/..."

[tasks."test:coverage"]
description = "Run tests with coverage report"
run = """
go test -v -coverprofile=coverage.out ./src/...
echo ""
echo "üìä Coverage by function:"
go tool cover -func=coverage.out
"""

[tasks.run]
description = "Build and run the application"
depends = ["build"]
run = "./build/suggest-claude-md"

[tasks.fmt]
description = "Format Go code"
run = """
go fmt ./src/...
echo "‚ú® Code formatted"
"""

[tasks.lint]
description = "Lint Go code"
run = """
if command -v docker >/dev/null 2>&1; then
  # Use v1.61.0 via docker for consistency with CI
  docker run --rm -v $(pwd):/app -w /app golangci/golangci-lint:v1.61.0 golangci-lint run --timeout=5m
else
  echo "‚ö†Ô∏è Docker not installed, using go vet instead"
  go vet ./src/...
fi
"""

[tasks.mod-update]
description = "Update Go modules"
run = """
go mod tidy
go mod download
echo "üì¶ Go modules updated"
"""

[tasks.help]
description = "Show available tasks"
run = "mise tasks"
